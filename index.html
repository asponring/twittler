<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="moment.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <section class="tweetStream">
      <h2>
        Your Tweet stream
      </h2>
      <button class="btn">
        Show <span id="numNewTweets"></span> New Tweets
      </button>
      <div class="tweets">
      </div>
      <div class="userTweets">
      </div>
    </section>
    <script>
      $(document).ready(function(){
        var currentTweetIndex = 0;
        var displayNewTweets = function(highestTweetIndex) {
          //make this function safe if no param passed in
          if (!highestTweetIndex) { 
            highestTweetIndex = streams.home.length - 1;
          }

          //update the timestamps of current tweets
          var tweetTime = $(".time").last();
          for (var i = 0; i < currentTweetIndex; i++) {
            tweetTime.text(moment(streams.home[i].created_at).fromNow());
            tweetTime = tweetTime.parent().prev().find(".time");
          }

          //show the new tweets
          for ( ; currentTweetIndex < highestTweetIndex; currentTweetIndex++) {
            $(".btn").hide();
            var tweet = streams.home[currentTweetIndex];
            var $tweet = $('<div class="tweet"></div>');
            $tweet.html('<span class="username">@' + tweet.user + '</span> &#183; <span class="time">' + moment(tweet.created_at).fromNow() + '</span><br><span class="tweetMsg">' + tweet.message + "</span>");
            $tweet.prependTo($(".tweets"));
            $tweet.on("click", ".username", function() { 
              displayUserTweets($(this).text().slice(1));
            });
          }
        };

        var checkForNewTweets = function() {
          var highestTweetIndex = streams.home.length - 1;
          if (highestTweetIndex > currentTweetIndex) {
            $(".btn").show();
            $("#numNewTweets").text(highestTweetIndex - currentTweetIndex);
            $("button").on("click", function() { displayNewTweets(highestTweetIndex); });
            return true;
          }
          return false;
        };

        var displayUserTweets = function(userName) {
          $(".tweets").hide();
        };

        displayNewTweets();
        setInterval(checkForNewTweets, 5000);

      });

    </script>
  </body>
</html>