<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <script>
      $(document).ready(function(){
        var $body = $('body');
        $body.html('<button class="btn">Show <span id="numNewTweets"></span> New Tweets</button>');

        var currentTweetIndex = 0;
        var displayNewTweets = function(highestTweetIndex) {
          if (!highestTweetIndex) { highestTweetIndex = streams.home.length - 1; }
          for ( ; currentTweetIndex < highestTweetIndex; currentTweetIndex++) {
            $(".btn").hide();
            var tweet = streams.home[currentTweetIndex];
            var $tweet = $('<div></div>');
            $tweet.text('@' + tweet.user + ': ' + tweet.message);
            $tweet.insertAfter($(".btn"));
          }
        };

        var checkForNewTweets = function() {
          var highestTweetIndex = streams.home.length - 1;
          if (highestTweetIndex > currentTweetIndex) {
            $(".btn").show();
            $("#numNewTweets").text(highestTweetIndex - currentTweetIndex);
            $("button").on("click", function() { displayNewTweets(highestTweetIndex); });
            return true;
          }
          return false;
        }

        displayNewTweets();
        setInterval(checkForNewTweets, 5000);

        /* Original code for displaying initial tweets which I'm not using
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<div></div>');
          $tweet.text('@' + tweet.user + ': ' + tweet.message);
          $tweet.appendTo($body);
          index -= 1;
        }
        */

      });

    </script>
  </body>
</html>